{% extends 'base.html' %} {% block content %}
<h2>All Components</h2>

<!-- Toolbar: Search, Filter -->
<div class="toolbar">
  <form
    method="get"
    action="{{ url_for('component.all_components') }}"
    class="toolbar-form"
    id="componentForm"
  >
    <!-- Search -->
    <div class="toolbar-group">
      <label for="search">Search:</label>
      <input
        type="text"
        name="search"
        id="search"
        value="{{ search_query }}"
        placeholder="Name or OID..."
      />
      <button type="submit" class="btn btn-sm">Search</button>
      {% if search_query or server_filter or category_filter %}
      <a
        href="{{ url_for('component.all_components') }}"
        class="btn btn-sm btn-secondary"
        >Clear</a
      >
      {% endif %}
    </div>

    <!-- Filters -->
    <div class="toolbar-filters">
      <div class="toolbar-group">
        <label for="server_id">Server:</label>
        <select
          name="server_id"
          id="server_id"
          onchange="document.getElementById('componentForm').submit()"
        >
          <option value="">All Servers</option>
          {% for server in servers %}
          <option
            value="{{ server.id }}"
            {%
            if
            server_filter=""
            ="server.id"
            %}selected{%
            endif
            %}
          >
            {{ server.name }}
          </option>
          {% endfor %}
        </select>
      </div>

      <div class="toolbar-group">
        <label for="category">Category:</label>
        <select
          name="category"
          id="category"
          onchange="document.getElementById('componentForm').submit()"
        >
          <option value="">All Categories</option>
          {% for cat in categories %}
          <option
            value="{{ cat }}"
            {%
            if
            category_filter=""
            ="cat"
            %}selected{%
            endif
            %}
          >
            {{ cat }}
          </option>
          {% endfor %}
        </select>
      </div>
    </div>
  </form>
</div>

<table class="component-table">
  <thead>
    <tr>
      <th>No</th>
      <th>Server</th>
      <th>Name</th>
      <th>OID</th>
      <th>Category</th>
      <th>Brand</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    {% for c in components %}
    <tr>
      <td>
        {{ (pagination.page - 1) * pagination.per_page + loop.index if
        pagination else loop.index }}
      </td>
      <td>{{ c.server.name }}</td>
      <td>{{ c.name }}</td>
      <td><code>{{ c.oid }}</code></td>
      <td>{{ c.category }}</td>
      <td>{{ c.brand }}</td>
      <td>
        <a
          href="{{ url_for('component.edit_component', server_id=c.server_id, component_id=c.id) }}"
          class="btn btn-sm"
          >Edit</a
        >
        <form
          method="post"
          action="{{ url_for('component.delete_component', server_id=c.server_id, component_id=c.id) }}"
          style="display: inline"
          onsubmit="
            return confirm('Are you sure you want to delete this component?');
          "
        >
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
          <button type="submit" class="btn btn-sm btn-danger">Delete</button>
        </form>
      </td>
    </tr>
    {% else %}
    <tr>
      <td colspan="7" class="text-center">No components found</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Pagination -->
{% if pagination and pagination.pages > 1 %}
<div class="pagination">
  {% if pagination.has_prev %}
  <a
    href="{{ url_for('component.all_components', page=pagination.prev_num, server_id=server_filter, category=category_filter, search=search_query) }}"
    class="btn btn-sm"
    >&laquo; Prev</a
  >
  {% endif %}

  <span class="page-info"
    >Page {{ pagination.page }} of {{ pagination.pages }} ({{ pagination.total
    }} total)</span
  >

  {% if pagination.has_next %}
  <a
    href="{{ url_for('component.all_components', page=pagination.next_num, server_id=server_filter, category=category_filter, search=search_query) }}"
    class="btn btn-sm"
    >Next &raquo;</a
  >
  {% endif %}
</div>
{% endif %} {% endblock %}
